local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local ESP = Instance.new("ScreenGui")
ESP.Name = "ESP"
ESP.Parent = game.CoreGui

local BoxESP = Instance.new("Frame")
BoxESP.Name = "BoxESP"
BoxESP.Size = UDim2.new(0, 100, 0, 100)
_G.BoxESP.BackgroundColor3 = Color3.new(1, 0, 0)
_G.BoxESP.BorderSizePixel = 0
BoxESP.Parent = ESP

local function DrawBoxESP(player)
    if player ~= Players.LocalPlayer then
        local character = player.Character
        if character then
            local rootPart = character:FindFirstChild("HumanoidRootPart")
            if rootPart then
                local distance = _G.ESPDistance or 100 -- Default distance is 100
                if _G.ESPDistance then
                    distance = _G.ESPDistance
                end
                if (rootPart.Position - Players.LocalPlayer.Character.HumanoidRootPart.Position).Magnitude <= distance then
                    local screenPos = game.Workspace.CurrentCamera:WorldToScreenPoint(rootPart.Position)
                    if screenPos then
                        local x, y = screenPos.X, screenPos.Y
                        local size = 5
                        local color = Color3.new(1, 0, 0)
                        local transparency = 0.5
                        BoxESP.Position = UDim2.new(0, x - size / 2, 0, y - size / 2)
                        BoxESP.Size = UDim2.new(0, size, 0, size)
                        BoxESP.BackgroundColor3 = color
                        BoxESP.BackgroundTransparency = transparency
                    end
                end
            end
        end
    end
end

RunService.RenderStepped:Connect(function()
    for _, player in ipairs(Players:GetPlayers()) do
        DrawBoxESP(player)
    end
end)
